#!@SHELL@
#
# Original wrapper by Paul Bijnens
#
# worked by Stefan G. Weichinger
# to enable gpg-encrypted dumps via aespipe
# also worked by Matthieu Lochegnies for server-side encryption

prefix=@prefix@
exec_prefix=@exec_prefix@
sbindir=@sbindir@
AMANDA_HOME=~@CLIENT_LOGIN@

AM_AESPIPE=@sbindir@/amaespipe
AM_PASSPHRASE=$AMANDA_HOME/.am_passphrase
PATH=/usr/bin:/usr/local/bin:/sbin:/usr/sbin:/opt/csw/bin
export PATH

AESPIPE=`which aespipe`

#+
# Function to:
#    Simplify gettext usage by allowing printf format
#    strings for translators, use _() identifier for
#    xgettext extraction similar to "C" usage and
#    collapsing "printf `gettext fmt` ...", which is
#    used everywhere, into one function.
#-
_() {
	fmt=`gettext -d amanda "$1"`
	shift
	printf "$fmt" $*
}


if [ $? -ne 0 ] ; then
	echo `_ '%s: %s was not found in %s' "$0" "aespipe" "$PATH"` >&2
        exit 2
fi

if [ ! -x $AESPIPE ] ; then
	echo `_ '%s: %s is not executable' "$0" "aespipe"` >&2
        exit 2
fi

if [ ! -x $AM_AESPIPE ] ; then
        echo `_ '%s: %s was not found' "$0" "$AM_AESPIPE"` >&2
        exit 2
fi
if [ ! -x $AM_AESPIPE ] ; then
        echo `_ '%s: %s is not executable' "$0" "$AM_AESPIPE"` >&2
        exit 2
fi

$AM_AESPIPE "$@" 3< $AM_PASSPHRASE

rc=$?
exit $rc
