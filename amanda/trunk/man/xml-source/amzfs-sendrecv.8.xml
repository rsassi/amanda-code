<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE refentry PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN"
                   "http://www.oasis-open.org/docbook/xml/4.1.2/docbookx.dtd"
[
  <!-- entities files to use -->
  <!ENTITY % global_entities SYSTEM '../entities/global.entities'>
  %global_entities;
]>

<refentry id='amzfs-sendrecv.8'>

<refmeta>
<refentrytitle>amzfs-sendrecv</refentrytitle>
<manvolnum>8</manvolnum>
</refmeta>
<refnamediv>
<refname>amzfs-sendrecv</refname>
<refpurpose>Amanda script to create zfs sendrecv</refpurpose>
</refnamediv>
<!-- body begins here -->

<refsect1><title>DESCRIPTION</title>

<para>amzfs-sendrecv is an &A; application implementing the Application API.
It should not be run by users directly.
It create a zfs snapshot of the filesystem and backup the snapshot with 'zfs send'.
Only full backup is done, no incremental backup.
Only the restoration of the complete backup is allowed, it is impossible to restore a single file.</para>

<para>The application is run as the amanda user, it must have the priviledge to create and destroy snapshot:
<programlisting>
    zfs allow -ldu AMANDA_USER mount,snapshot,destroy,send,receive FILESYSTEM
</programlisting></para>

<para>Some system doesn't have "zfs allow", but you can give the Amanda backup user the rights to manipulate ZFS filesystems by using the following command:
<programlisting>
usermod -P "ZFS File System Management,ZFS Storage Management" AMANDA_USER
</programlisting>
This will require that your run zfs under pfexec, set the PFEXEC property to YES.</para>

<para>The format of the DLE must be one of:
<programlisting>
Desciption              Example
----------              -------
Mountpoint              /data
ZFS pool name           datapool
ZFS filesystem          datapool/database
ZFS logical volume      datapool/dbvol
</programlisting></para>

<para>The filesystem doesn't need to be mounted.</para>

</refsect1>

<refsect1><title>PROPERTIES</title>

<para>This section lists the properties that control amzfs-sendrecv's functionality.
See <citerefentry><refentrytitle>amanda-applications</refentrytitle><manvolnum>7</manvolnum></citerefentry>
for information on the Application API, application configuration.</para>

<!-- PLEASE KEEP THIS LIST IN ALPHABETICAL ORDER -->
<variablelist>
 <!-- ==== -->
 <varlistentry><term>DF-PATH</term><listitem>
Path to the 'df' binary, search in $PATH by default.
</listitem></varlistentry>
 <!-- ==== -->
 <varlistentry><term>ZFS-PATH</term><listitem>
Path to the 'zfs' binary, search in $PATH by default.
</listitem></varlistentry>
 <!-- ==== -->
 <varlistentry><term>PFEXEC-PATH</term><listitem>
Path to the 'pfexec' binary, search in $PATH by default.
</listitem></varlistentry>
 <!-- ==== -->
 <varlistentry><term>PFEXEC</term><listitem>
If "NO" (the default), pfexec is not used, if set to "YES" then pfexec is used.
</listitem></varlistentry>
</variablelist>

</refsect1>

<refsect1><title>EXAMPLE</title>

In this example, a dumptype is defined to use amzfs-sendrecv application to backup a zfs filesystem.

<programlisting>
 define application-tool amzfs_sendrecv {
   comment "amzfs-sendrecv"
   plugin "amzfs-sendrecv"
   #property "DF-PATH"  "/usr/sbin/df"
   #property "ZFS-PATH" "/usr/sbin/zfs"
   #property "PFEXEC-PATH" "/usr/sbin/pfexec"
   #property "PFEXEC" "NO"
 }

 define dumptype user-zfs-sendrecv {
   program "APPLICATAION"
   application "amzfs_sendrecv"
 }
</programlisting>
</refsect1>

<refsect1><title>AUTHORS</title>

<para>Jean-Louis Martineau &email.jlm;: Original text</para>
</refsect1>

<refsect1><title>SEE ALSO</title>
<para>
<citerefentry><refentrytitle>amanda.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>,
<citerefentry><refentrytitle>amanda-client.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>,
<citerefentry><refentrytitle>amanda-applications</refentrytitle><manvolnum>7</manvolnum></citerefentry>
</para>

</refsect1>
</refentry>
